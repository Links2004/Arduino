<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>ESP8266: filesystem</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ESP8266
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">filesystem </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><hr/>
 <h2>title: <a class="el" href="../../d1/d31/class_file.html">File</a> System </h2>
<h2>Table of Contents</h2>
<ul>
<li><a href="../../#flash-layout">Flash layout</a></li>
<li><a href="../../#uploading-files-to-file-system">Uploading files to file system</a></li>
<li><a href="../../#file-system-object-spiffs">File system object (SPIFFS)</a><ul>
<li><a href="../../#begin">begin</a></li>
<li><a href="../../#format">format</a></li>
<li><a href="../../#open">open</a></li>
<li><a href="../../#exists">exists</a></li>
<li><a href="../../#opendir">openDir</a></li>
<li><a href="../../#remove">remove</a></li>
<li><a href="../../#rename">rename</a></li>
<li><a href="../../#info">info</a></li>
</ul>
</li>
<li><a href="../../#filesystem-information-structure">Filesystem information structure</a></li>
<li><a href="../../#directory-object-dir">Directory object (Dir)</a></li>
<li><a href="../../#file-object">File object</a><ul>
<li><a href="../../#seek">seek</a></li>
<li><a href="../../#position">position</a></li>
<li><a href="../../#size">size</a></li>
<li><a href="../../#name">name</a></li>
<li><a href="../../#close">close</a></li>
</ul>
</li>
</ul>
<h2>Flash layout</h2>
<p>Even though file system is stored on the same flash chip as the program, programming new sketch will not modify file system contents. This allows to use file system to store sketch data, configuration files, or content for Web server.</p>
<p>The following diagram illustrates flash layout used in Arduino environment: </p><pre class="fragment">|--------------|-------|---------------|--|--|--|--|--|
^              ^       ^               ^     ^
Sketch    OTA update   File system   EEPROM  WiFi config (SDK)
</pre><p><a class="el" href="../../d1/d31/class_file.html">File</a> system size depends on the flash chip size. Depending on the board which is selected in IDE, you have the following options for flash size:</p>
<table class="doxtable">
<tr>
<th>Board </th><th>Flash chip size, bytes </th><th><a class="el" href="../../d1/d31/class_file.html">File</a> system size, bytes  </th></tr>
<tr>
<td>Generic module </td><td>512k </td><td>64k </td></tr>
<tr>
<td>Generic module </td><td>1M </td><td>64k, 128k, 256k, 512k </td></tr>
<tr>
<td>Generic module </td><td>2M </td><td>1M </td></tr>
<tr>
<td>Generic module </td><td>4M </td><td>3M </td></tr>
<tr>
<td>Adafruit HUZZAH </td><td>4M </td><td>1M, 3M </td></tr>
<tr>
<td>NodeMCU 0.9 </td><td>4M </td><td>1M, 3M </td></tr>
<tr>
<td>NodeMCU 1.0 </td><td>4M </td><td>1M, 3M </td></tr>
<tr>
<td>Olimex MOD-WIFI-ESP8266(-DEV)</td><td>2M </td><td>1M </td></tr>
<tr>
<td>SparkFun Thing </td><td>512k </td><td>64k </td></tr>
<tr>
<td>SweetPea ESP-210 </td><td>4M </td><td>1M, 3M </td></tr>
<tr>
<td>WeMos D1 &amp; D1 mini </td><td>4M </td><td>1M, 3M </td></tr>
</table>
<p><b>Note:</b> to use any of file system functions in the sketch, add the following include to the sketch:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;#include &quot;FS.h&quot;</div>
</div><!-- fragment --><h2>Uploading files to file system</h2>
<p><em>ESP8266FS</em> is a tool which integrates into the Arduino IDE. It adds a menu item to <em>Tools</em> menu for uploading the contents of sketch data directory into ESP8266 flash file system.</p>
<ul>
<li>Download the tool: <a href="https://github.com/esp8266/arduino-esp8266fs-plugin/releases/download/0.1.3/ESP8266FS-0.1.3.zip">https://github.com/esp8266/arduino-esp8266fs-plugin/releases/download/0.1.3/ESP8266FS-0.1.3.zip</a>.</li>
<li>In your Arduino sketchbook directory, create <code>tools</code> directory if it doesn't exist yet</li>
<li>Unpack the tool into <code>tools</code> directory (the path will look like <code>&lt;home_dir&gt;/Arduino/tools/ESP8266FS/tool/esp8266fs.jar</code>)</li>
<li>Restart Arduino IDE</li>
<li>Open a sketch (or create a new one and save it)</li>
<li>Go to sketch directory (choose Sketch &gt; Show Sketch Folder)</li>
<li>Create a directory named <code>data</code> and any files you want in the file system there</li>
<li>Make sure you have selected a board, port, and closed Serial Monitor</li>
<li>Select Tools &gt; ESP8266 Sketch Data Upload. This should start uploading the files into ESP8266 flash file system. When done, IDE status bar will display <code>SPIFFS Image Uploaded</code> message.</li>
</ul>
<h2><a class="el" href="../../d1/d31/class_file.html">File</a> system object (SPIFFS)</h2>
<h3>begin</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;SPIFFS.begin()</div>
</div><!-- fragment --><p>This method mounts SPIFFS file system. It must be called before any other FS APIs are used. Returns <em>true</em> if file system was mounted successfully, false otherwise.</p>
<h3>format</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;SPIFFS.format()</div>
</div><!-- fragment --><p>Formats the file system. May be called either before or after calling <code>begin</code>. Returns <em>true</em> if formatting was successful.</p>
<h3>open</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;SPIFFS.open(path, mode)</div>
</div><!-- fragment --><p>Opens a file. <code>path</code> should be an absolute path starting with a slash (e.g. <code>/dir/filename.txt</code>). <code>mode</code> is a string specifying access mode. It can be one of "r", "w", "a", "r+", "w+", "a+". Meaning of these modes is the same as for <code>fopen</code> C function.</p>
<p>Returns <em><a class="el" href="../../d1/d31/class_file.html">File</a></em> object. To check whether the file was opened successfully, use the boolean operator.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;File f = SPIFFS.open(&quot;/f.txt&quot;, &quot;w&quot;);</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;if (!f) {</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    Serial.println(&quot;file open failed&quot;);</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;}</div>
</div><!-- fragment --><h3>exists</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;SPIFFS.exists(path)</div>
</div><!-- fragment --><p>Returns <em>true</em> if a file with given path exists, <em>false</em> otherwise.</p>
<h3>openDir</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;SPIFFS.openDir(path)</div>
</div><!-- fragment --><p>Opens a directory given its absolute path. Returns a <em>Dir</em> object.</p>
<h3>remove</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;SPIFFS.remove(path)</div>
</div><!-- fragment --><p>Deletes the file given its absolute path. Returns <em>true</em> if file was deleted successfully.</p>
<h3>rename</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;SPIFFS.rename(pathFrom, pathTo)</div>
</div><!-- fragment --><p>Renames file from <code>pathFrom</code> to <code>pathTo</code>. Paths must be absolute. Returns <em>true</em> if file was renamed successfully.</p>
<h3>info</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;FSInfo fs_info;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;SPIFFS.info(fs_info);</div>
</div><!-- fragment --><p>Fills <a href="../../#filesystem-information-structure">FSInfo structure</a> with information about the file system. Returns <code>true</code> is successful, <code>false</code> otherwise.</p>
<h2>Filesystem information structure</h2>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;struct FSInfo {</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;    size_t totalBytes;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    size_t usedBytes;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    size_t blockSize;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    size_t pageSize;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;    size_t maxOpenFiles;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    size_t maxPathLength;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;};</div>
</div><!-- fragment --><p>This is the structure which may be filled using FS::info method.</p><ul>
<li><code>totalBytes</code> — total size of useful data on the file system</li>
<li><code>usedBytes</code> — number of bytes used by files</li>
<li><code>blockSize</code> — SPIFFS block size</li>
<li><code>pageSize</code> — SPIFFS logical page size</li>
<li><code>maxOpenFiles</code> — max number of files which may be open simultaneously</li>
<li><code>maxPathLength</code> — max file name length (including one byte for zero termination)</li>
</ul>
<h2>Directory object (Dir)</h2>
<p>The purpose of <em>Dir</em> object is to iterate over files inside a directory. It provides three methods: <code>next()</code>, <code>fileName()</code>, and <code>openFile(mode)</code>.</p>
<p>The following example shows how it should be used:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Dir dir = SPIFFS.openDir(&quot;/data&quot;);</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;while (dir.next()) {</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;    Serial.print(dir.fileName());</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;    File f = dir.openFile(&quot;r&quot;);</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;    Serial.println(f.size());</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;}</div>
</div><!-- fragment --><p><code>dir.next()</code> returns true while there are files in the directory to iterate over. It must be called before calling <code>fileName</code> and <code>openFile</code> functions.</p>
<p><code>openFile</code> method takes <em>mode</em> argument which has the same meaning as for <code>SPIFFS.open</code> function.</p>
<h2><a class="el" href="../../d1/d31/class_file.html">File</a> object</h2>
<p><code>SPIFFS.open</code> and <code>dir.openFile</code> functions return a <em><a class="el" href="../../d1/d31/class_file.html">File</a></em> object. This object supports all the functions of <em><a class="el" href="../../d1/d51/class_stream.html">Stream</a></em>, so you can use <code>readBytes</code>, <code>findUntil</code>, <code>parseInt</code>, <code>println</code>, and all other <em><a class="el" href="../../d1/d51/class_stream.html">Stream</a></em> methods.</p>
<p>There are also some functions which are specific to <em><a class="el" href="../../d1/d31/class_file.html">File</a></em> object.</p>
<h3>seek</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;file.seek(offset, mode)</div>
</div><!-- fragment --><p>This function behaves like <code>fseek</code> C function. Depending on the value of <code>mode</code>, it moves current position in a file as follows:</p>
<ul>
<li>if <code>mode</code> is <code>SeekSet</code>, position is set to <code>offset</code> bytes from the beginning.</li>
<li>if <code>mode</code> is <code>SeekCur</code>, current position is moved by <code>offset</code> bytes.</li>
<li>if <code>mode</code> is <code>SeekEnd</code>, position is set to <code>offset</code> bytes from the end of the file.</li>
</ul>
<p>Returns <em>true</em> if position was set successfully.</p>
<h3>position</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;file.position()</div>
</div><!-- fragment --><p>Returns the current position inside the file, in bytes.</p>
<h3>size</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;file.size()</div>
</div><!-- fragment --><p>Returns file size, in bytes.</p>
<h3>name</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;String name = file.name();</div>
</div><!-- fragment --><p>Returns file name, as <code>const char*</code>. Convert it to <em>String</em> for storage.</p>
<h3>close</h3>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{c++}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;file.close()</div>
</div><!-- fragment --><p>Close the file. No other operations should be performed on <em><a class="el" href="../../d1/d31/class_file.html">File</a></em> object after <code>close</code> function was called. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
